# BotOfTheSpecter Discord Bot - Version 6.1 (2026-01-12)

## Version Information

* Updated version from 6.0 to 6.1
* Focused on Custom Embed Builder system for creating rich, formatted Discord messages

## New Features & Major Changes

### Custom Embed Builder

* Added comprehensive `CustomEmbedCog` to create and send custom embeds to Discord channels
* Created `custom_embeds` database table to store embed configurations for reuse
* Added `custom_embed_configuration` JSON column to `server_management` table for per-guild settings
* Web dashboard interface for building embeds with live preview

### Embed Configuration Options

* **Basic Settings**:
  * **Embed Title**: Main title text for the embed
  * **Embed Description**: Main body text content
  * **Embed Color**: Hex color code for the left border
  * **Embed URL**: Optional clickable link for the title
* **Author Section**:
  * Author Name
  * Author URL (clickable link)
  * Author Icon URL (small image next to author name)
* **Footer Section**:
  * Footer Text
  * Footer Icon URL (small image in footer)
  * Footer Timestamp toggle (adds current time to footer)
* **Thumbnail**: Small image displayed in top-right corner
* **Main Image**: Large image displayed in embed body
* **Fields**: Up to 25 custom fields with name, value, and inline options

### Embed Management

* Save embed configurations to database for reuse
* Edit and update existing saved embeds
* Delete saved embeds
* Preview embeds before sending
* Send embeds to any configured Discord channel
* Duplicate existing embeds to create variations

### Dashboard Integration

* Interactive embed builder with live preview pane
* Drag-and-drop field reordering
* Real-time color picker with hex input
* Channel selector dropdown for target channel
* Save/Load/Delete embed templates
* One-click sending to Discord channels

### Database Schema

* New table: `custom_embeds` with columns:
  * `id` (auto-increment primary key)
  * `server_id` (guild identifier)
  * `embed_name` (user-friendly name for saved embed)
  * `title` (embed title text)
  * `description` (embed description text)
  * `color` (hex color code)
  * `url` (optional embed URL)
  * `author_name` (author section name)
  * `author_url` (author section URL)
  * `author_icon` (author section icon URL)
  * `footer_text` (footer text)
  * `footer_icon` (footer icon URL)
  * `thumbnail_url` (thumbnail image URL)
  * `image_url` (main image URL)
  * `fields` (JSON array of field objects)
  * `timestamp_enabled` (boolean for footer timestamp)
  * `created_at` (timestamp of embed creation)
  * `updated_at` (timestamp of last update)
  * Indexes on `server_id` and `embed_name` for efficient querying

### WebSocket Events

* `CUSTOM_EMBED_SENT` - Notifies when embed is successfully sent to channel
* `CUSTOM_EMBED_SAVED` - Notifies when embed template is saved
* `CUSTOM_EMBED_DELETED` - Notifies when embed template is deleted

### Validation & Security

* Validates all URLs (embed, author, footer, thumbnail, image) for proper format
* Enforces Discord embed limits:
  * Title: 256 characters max
  * Description: 4096 characters max
  * Fields: 25 max, each with 256 char name and 1024 char value
  * Footer: 2048 characters max
  * Author: 256 characters max
  * Total embed size: 6000 characters max
* Verifies bot has permission to send messages in target channel
* Rate limiting on embed sending to prevent spam

### Per-User Logging System

* **Implemented dual-logging system** for better user support and debugging:
  * **Admin Log**: Central log file (`/home/botofthespecter/logs/specterdiscord/discordbot.txt`) contains all bot events
  * **User Logs**: Individual log files per user (`/home/botofthespecter/logs/specterdiscord/{username}.txt`) contain only events for that user's server
* **UserLogger Class** with automatic username resolution:
  * Resolves username from `channel_code` or `guild_id` via database queries
  * Caches username lookups and logger instances for optimal performance
  * Sanitizes usernames for filesystem safety
  * Fully async logging methods: `info()`, `warning()`, `error()`, `debug()`
* **Benefits**:
  * Users can now receive their own log files for troubleshooting without admin intervention
  * Easier support debugging - admins and users see the same relevant events
  * Privacy-focused - users only see logs for their own servers
  * No performance impact on existing admin logging
* **Comprehensive documentation** added:
  * `USER_LOGGING.md` - Complete implementation guide and best practices
  * `USER_LOGGING_EXAMPLES.md` - Practical examples and migration guide

## Bug Fixes & Improvements

* Enhanced error handling for invalid embed configurations
* Improved color validation with fallback to default Discord gray
* Graceful handling of missing images (invalid URLs)
* Better mobile responsiveness for embed builder dashboard
* Optimized database queries for embed retrieval
* **Fixed stream online/offline notification system**:
  * Added fallback voice channel status updates when WebSocket notifications are missed
  * Improved error logging in fallback Twitch API check (changed from debug to error level)
  * Added automatic voice channel name update to online status (ðŸŸ¢) when Twitch API detects stream is live but WebSocket didn't notify
  * Added automatic voice channel name update to offline status (ðŸ”´) when Twitch API detects stream is offline
  * Implemented backup mechanism to update voice channel status even if primary notification system fails
  * Resolves issue where voice channels remained stuck showing "live" status for hours after streams ended
  * Added detailed logging for all fallback status updates to aid in troubleshooting

**Thank you for your feedback and support!**

As always, your feedback is appreciated. Please report any issues, bugs, or suggestions in the #ticket-info channel on our Discord server. You can also submit feedback and bug reports directly on our website: [https://botofthespecter.com/feedback.php](https://botofthespecter.com/feedback.php)
