<%- include('header') %>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <h1 class="text-center text-4xl font-bold mb-12">BotOfTheSpecter Roadmap</h1>

        <!-- Completion Summary Section -->
        <div class="mb-12 bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-8 shadow-lg">
            <h2 class="text-2xl font-semibold mb-6">Project Overview</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-300"><%= stats.total_categories || 0 %></div>
                    <div class="text-sm text-blue-200">Categories</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-300"><%= stats.total_boards || 0 %></div>
                    <div class="text-sm text-green-200">Boards</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-300"><%= stats.active_items || 0 %></div>
                    <div class="text-sm text-yellow-200">Active Items</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-300"><%= stats.completed_items || 0 %></div>
                    <div class="text-sm text-purple-200">Completed</div>
                </div>
            </div>
        </div>

        <!-- Categories Grid -->
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold">Categories</h2>
            <% if (user && user.admin) { %>
                <button id="create-category-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium">
                    <i class="fas fa-plus mr-2"></i>Create Category
                </button>
            <% } %>
        </div>
        <div id="categories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <!-- Categories will be loaded here -->
        </div>

        <!-- Completed Items Section -->
        <div id="completed-section" class="hidden">
            <h2 class="text-2xl font-semibold mb-6">Recently Completed</h2>
            <div id="completed-items" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Completed items will be loaded here -->
            </div>
        </div>

        <!-- Beta Testing Items Section -->
        <div id="beta-section" class="hidden">
            <h2 class="text-2xl font-semibold mb-6">Beta Testing</h2>
            <div id="beta-items" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Beta items will be loaded here -->
            </div>
        </div>

        <!-- Create Category Modal -->
        <div id="create-category-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                <h3 class="text-xl font-semibold mb-4">Create New Category</h3>
                <form id="create-category-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Category Name</label>
                        <input type="text" id="category-name" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Description</label>
                        <textarea id="category-description" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="cancel-create" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function loadStats() {
            // Stats are already loaded server-side
        }

        function loadCategories() {
            $.get('/api/categories', function(categories) {
                const container = $('#categories');
                container.empty();

                if (categories.length === 0) {
                    container.append('<p class="text-center text-gray-400 col-span-full">No categories found.</p>');
                    return;
                }

                categories.forEach(category => {
                    const categoryCard = `
                        <div class="bg-white bg-opacity-10 backdrop-blur-md rounded-lg p-6 shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="openCategory(${category.id})">
                            <h3 class="text-xl font-semibold mb-2">${category.name}</h3>
                            <p class="text-blue-200 mb-4">${category.description || 'No description'}</p>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-blue-300">ID: ${category.id}</span>
                                <span class="text-green-300">View Board â†’</span>
                            </div>
                        </div>
                    `;
                    container.append(categoryCard);
                });
            }).fail(function() {
                toastr.error('Failed to load categories');
            });
        }

        function openCategory(categoryId) {
            $.get('/api/get-board?category_id=' + categoryId, function(data) {
                if (data.board) {
                    window.location.href = '/board/' + data.board.id;
                } else {
                    toastr.error('No board found for this category');
                }
            });
        }

        // Create category functionality
        $('#create-category-btn').click(function() {
            $('#create-category-modal').removeClass('hidden');
        });

        $('#cancel-create').click(function() {
            $('#create-category-modal').addClass('hidden');
        });

        $('#create-category-form').submit(function(e) {
            e.preventDefault();
            const name = $('#category-name').val();
            const description = $('#category-description').val();

            $.ajax({
                url: '/api/categories',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ name, description }),
                success: function() {
                    $('#create-category-modal').addClass('hidden');
                    $('#category-name').val('');
                    $('#category-description').val('');
                    loadCategories();
                    toastr.success('Category created successfully');
                },
                error: function(xhr) {
                    toastr.error(xhr.responseJSON?.error || 'Failed to create category');
                }
            });
        });

        // Load data on page load
        $(document).ready(function() {
            loadCategories();
        });
    </script>

<%- include('footer') %>